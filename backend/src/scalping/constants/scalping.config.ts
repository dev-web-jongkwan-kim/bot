/**
 * 스캘핑 전략 설정
 *
 * 초단타 스캘핑 (30분 이내 청산) 전략 파라미터
 * - 목표: TP 0.30-0.45%, SL 0.10-0.15% (RR 3:1, 수수료 반영)
 * - 예상 거래 빈도: 일 30-50회
 * 
 * v2 개선사항 (2026-01-14):
 * - R:R 2:1 → 3:1 (수수료 반영 후 실제 R:R ≈ 2.7:1)
 * - 진입가 계산 개선 (체결 확률 향상)
 * - TP 축소 로직 제거 (수익 보호)
 * - 본전 청산 로직 제거 (TP 도달 기회 확대)
 * - 필터 완화 (OI 1% → 0.5%, 추세 강도 0.3 → 0.2)
 */
export const SCALPING_CONFIG = {
  // ============================================
  // 스캔 설정
  // ============================================
  scan: {
    /**
     * 스캔 주기 (밀리초)
     * - 1분(60000ms)마다 전체 종목 스캔
     */
    intervalMs: 60000,

    /**
     * 모니터링 종목 수
     */
    maxSymbols: 140,
  },

  // ============================================
  // 1차 필터: 거시적 조건
  // ============================================
  filter1: {
    /**
     * Funding Rate 필터
     *
     * 롱 진입 시: Funding < maxForLong (0.05%)
     * 숏 진입 시: Funding > minForShort (0.03%)
     */
    funding: {
      maxForLong: 0.0005, // 0.05%
      minForShort: 0.0003, // 0.03%
      extremeHigh: 0.001, // 0.1% (극단적 롱 과열)
      extremeLow: -0.001, // -0.1% (극단적 숏 과열)
    },

    /**
     * 스프레드 필터
     * - 0.1% 이상이면 슬리피지 위험으로 제외
     */
    maxSpreadPercent: 0.001, // 0.1%

    /**
     * 24시간 거래량 필터
     * - 하위 20% 거래량 종목 제외
     */
    minVolumeRank: 0.2,
  },

  // ============================================
  // 2차 필터: 15분봉 추세
  // ============================================
  filter2: {
    /**
     * 고저점 비교 봉 수
     * - 4개 = 최근 1시간
     */
    trendBars: 4,

    /**
     * 추세 강도 최소값
     * - 0.2 이상이어야 유효한 추세로 인정 (완화: 0.3 → 0.2)
     */
    minTrendStrength: 0.2,

    /**
     * OI 변화율 임계값
     * - 0.5% 이상 증가를 "신규 진입"으로 판단 (완화: 1% → 0.5%)
     * - 선택 조건으로 적용 (필수 → 선택)
     */
    oiChangeThreshold: 0.005, // 0.5%
    oiRequired: false, // OI 증가 선택 (필수 해제)
  },

  // ============================================
  // 3차 필터: 5분봉 모멘텀
  // ============================================
  filter3: {
    /**
     * 모멘텀 분석 봉 수
     * - 5개 = 최근 25분
     */
    momentumBars: 5,

    /**
     * 봉 크기 비율 임계값
     * - < 0.5 = 소진 (EXHAUSTED)
     * - > 0.8 = 모멘텀 진행 중 (MOMENTUM)
     * - 0.5~0.8 = 풀백 (PULLBACK) ← 진입 기회
     */
    bodySizeRatio: {
      exhausted: 0.5,
      momentum: 0.8,
      maxMomentumForEntry: 2.5, // MOMENTUM 상태에서도 이 값 이하면 진입 가능
    },

    /**
     * 거래량 감소 임계값
     * - 0.7 미만이면 거래량 감소 = 소진 신호
     */
    volumeDecreaseRatio: 0.7,

    /**
     * CVD 분석 봉 수
     */
    cvdBars: 3,
  },

  // ============================================
  // 주문 설정
  // ============================================
  order: {
    /**
     * 진입 오프셋 (ATR 배수)
     * - Limit 주문 가격 = 현재가 ± (ATR × offset)
     * - 체결 확률 향상을 위해 0.05로 축소 (0.1 → 0.05)
     * - LONG: 현재가 + offset (유리한 방향)
     * - SHORT: 현재가 - offset (유리한 방향)
     */
    entryOffsetAtr: 0.05,

    /**
     * TP (Take Profit) 거리 (ATR 배수)
     * - R:R 3:1 비율 (수수료 반영 후 실제 R:R ≈ 2.7:1)
     */
    tpAtr: 3.0,

    /**
     * SL (Stop Loss) 거리 (ATR 배수)
     * - R:R 3:1 비율
     */
    slAtr: 1.0,

    /**
     * ATR 계산 기간
     */
    atrPeriod: 14,

    /**
     * 미체결 타임아웃 (초)
     * - 180초 = 3분
     */
    unfillTimeoutSec: 180,
  },

  // ============================================
  // 포지션 관리
  // ============================================
  position: {
    /**
     * 최대 보유 시간 (초)
     * - 30분 = 1800초
     */
    maxHoldTimeSec: 1800,

    /**
     * TP 축소 시작 시간 (초)
     * - 비활성화 (999999초 = 약 11일, 사실상 무효)
     * - TP 축소 로직 제거로 수익 보호
     */
    tpReduceTimeSec: 999999,

    /**
     * TP 축소 비율
     * - 비활성화됨 (사용 안 함)
     */
    tpReduceRatio: 0.5,

    /**
     * 본전 청산 시작 시간 (초)
     * - 비활성화 (999999초 = 약 11일, 사실상 무효)
     * - 본전 청산 로직 제거로 TP 도달 기회 확대
     */
    breakevenTimeSec: 999999,
  },

  // ============================================
  // 리스크 관리
  // ============================================
  risk: {
    /**
     * 동시 최대 포지션 수
     */
    maxPositions: 20,

    /**
     * 동일 방향 최대 포지션 수
     */
    maxSameDirection: 10,

    /**
     * 거래당 리스크 비율
     * - 계좌의 0.5%를 1회 거래에 리스크
     */
    riskPerTrade: 0.005, // 0.5%

    /**
     * 일일 최대 손실
     * - 1.0 = 100% (사실상 해제)
     */
    maxDailyLoss: 1.0, // 해제

    /**
     * 연속 손실 후 휴식
     */
    consecutiveLossLimit: 3,
    cooldownMinutes: 30,

    /**
     * 레버리지 (고정)
     */
    leverage: 15,
  },
};

/**
 * 설정값 타입 정의
 */
export type ScalpingConfig = typeof SCALPING_CONFIG;
