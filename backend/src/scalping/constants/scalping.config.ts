/**
 * 스캘핑 전략 설정
 *
 * 초단타 스캘핑 (30분 이내 청산) 전략 파라미터
 * - 목표: TP 0.25-0.40%, SL 0.12-0.20% (RR 2:1)
 * - 예상 거래 빈도: 일 30-50회
 */
export const SCALPING_CONFIG = {
  // ============================================
  // 스캔 설정
  // ============================================
  scan: {
    /**
     * 스캔 주기 (밀리초)
     * - 1분(60000ms)마다 전체 종목 스캔
     */
    intervalMs: 60000,

    /**
     * 모니터링 종목 수
     */
    maxSymbols: 140,
  },

  // ============================================
  // 1차 필터: 거시적 조건
  // ============================================
  filter1: {
    /**
     * Funding Rate 필터
     *
     * 롱 진입 시: Funding < maxForLong (0.05%)
     * 숏 진입 시: Funding > minForShort (0.03%)
     */
    funding: {
      maxForLong: 0.0005, // 0.05%
      minForShort: 0.0003, // 0.03%
      extremeHigh: 0.001, // 0.1% (극단적 롱 과열)
      extremeLow: -0.001, // -0.1% (극단적 숏 과열)
    },

    /**
     * 스프레드 필터
     * - 0.1% 이상이면 슬리피지 위험으로 제외
     */
    maxSpreadPercent: 0.001, // 0.1%

    /**
     * 24시간 거래량 필터
     * - 하위 20% 거래량 종목 제외
     */
    minVolumeRank: 0.2,
  },

  // ============================================
  // 2차 필터: 15분봉 추세
  // ============================================
  filter2: {
    /**
     * 고저점 비교 봉 수
     * - 4개 = 최근 1시간
     */
    trendBars: 4,

    /**
     * OI 변화율 임계값
     * - 1% 이상 증가를 "신규 진입"으로 판단
     */
    oiChangeThreshold: 0.01, // 1%
  },

  // ============================================
  // 3차 필터: 5분봉 모멘텀
  // ============================================
  filter3: {
    /**
     * 모멘텀 분석 봉 수
     * - 5개 = 최근 25분
     */
    momentumBars: 5,

    /**
     * 봉 크기 비율 임계값
     * - < 0.5 = 소진 (EXHAUSTED)
     * - > 0.8 = 모멘텀 진행 중 (MOMENTUM)
     * - 0.5~0.8 = 풀백 (PULLBACK) ← 진입 기회
     */
    bodySizeRatio: {
      exhausted: 0.5,
      momentum: 0.8,
    },

    /**
     * 거래량 감소 임계값
     * - 0.7 미만이면 거래량 감소 = 소진 신호
     */
    volumeDecreaseRatio: 0.7,

    /**
     * CVD 분석 봉 수
     */
    cvdBars: 3,
  },

  // ============================================
  // 주문 설정
  // ============================================
  order: {
    /**
     * 진입 오프셋 (ATR 배수)
     * - Limit 주문 가격 = 현재가 ± (ATR × offset)
     * - 빠른 체결을 위해 0.1로 축소
     */
    entryOffsetAtr: 0.1,

    /**
     * TP (Take Profit) 거리 (ATR 배수)
     * - 빠른 수익 실현 (R:R 1:1)
     */
    tpAtr: 1.0,

    /**
     * SL (Stop Loss) 거리 (ATR 배수)
     * - 너무 빠른 청산 방지
     */
    slAtr: 1.0,

    /**
     * ATR 계산 기간
     */
    atrPeriod: 14,

    /**
     * 미체결 타임아웃 (초)
     * - 180초 = 3분
     */
    unfillTimeoutSec: 180,
  },

  // ============================================
  // 포지션 관리
  // ============================================
  position: {
    /**
     * 최대 보유 시간 (초)
     * - 30분 = 1800초
     */
    maxHoldTimeSec: 1800,

    /**
     * TP 축소 시작 시간 (초)
     * - 20분 = 1200초
     */
    tpReduceTimeSec: 1200,

    /**
     * TP 축소 비율
     * - 0.5 = 50%로 축소
     */
    tpReduceRatio: 0.5,

    /**
     * 본전 청산 시작 시간 (초)
     * - 25분 = 1500초
     */
    breakevenTimeSec: 1500,
  },

  // ============================================
  // 리스크 관리
  // ============================================
  risk: {
    /**
     * 동시 최대 포지션 수
     */
    maxPositions: 20,

    /**
     * 동일 방향 최대 포지션 수
     */
    maxSameDirection: 10,

    /**
     * 거래당 리스크 비율
     * - 계좌의 0.5%를 1회 거래에 리스크
     */
    riskPerTrade: 0.005, // 0.5%

    /**
     * 일일 최대 손실
     * - 1.0 = 100% (사실상 해제)
     */
    maxDailyLoss: 1.0, // 해제

    /**
     * 연속 손실 후 휴식
     */
    consecutiveLossLimit: 3,
    cooldownMinutes: 30,

    /**
     * 레버리지 (고정)
     */
    leverage: 15,
  },
};

/**
 * 설정값 타입 정의
 */
export type ScalpingConfig = typeof SCALPING_CONFIG;
